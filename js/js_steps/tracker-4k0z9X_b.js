// Generated by CoffeeScript 1.3.1
(function() {
  var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  $(function() {
    var tracker;
    if (typeof App === "undefined" || App === null) {
      return;
    }
    tracker = Wmw.Tracker.get();
    return App.vent.bind("ad:impression", tracker.trackAdImpression);
  });

  Wmw.Tracker = (function() {
    var _instance;

    Tracker.name = 'Tracker';

    function Tracker() {
      this.__addExperimentVersionInformation = __bind(this.__addExperimentVersionInformation, this);

      this.trackStarRatingClick = __bind(this.trackStarRatingClick, this);

      this._trackClick = __bind(this._trackClick, this);

      this._trackPageView = __bind(this._trackPageView, this);

      this._injectTrackingPixel = __bind(this._injectTrackingPixel, this);

      this.trackAdImpression = __bind(this.trackAdImpression, this);

      this.trackBuyButtonClick = __bind(this.trackBuyButtonClick, this);

      this.trackShareClick = __bind(this.trackShareClick, this);

      this.trackGiftCardsView = __bind(this.trackGiftCardsView, this);

      this.trackPurchaseView = __bind(this.trackPurchaseView, this);

      this.trackCheckoutView = __bind(this.trackCheckoutView, this);

      this.trackDealView = __bind(this.trackDealView, this);

    }

    _instance = void 0;

    Tracker.get = function() {
      return _instance != null ? _instance : _instance = new Wmw.Tracker();
    };

    Tracker.prototype.PAGE_TYPE_DOD_DEAL = "dod";

    Tracker.prototype.PAGE_TYPE_CHECKOUT = "checkout";

    Tracker.prototype.PAGE_TYPE_PURCHASE = "purchase_conf";

    Tracker.prototype.PAGE_TYPE_GIFT_CARDS = "gift_cards";

    Tracker.prototype.trackDealView = function(permalink) {
      return this._injectTrackingPixel(this.PAGE_TYPE_DOD_DEAL, {
        d: permalink
      });
    };

    Tracker.prototype.trackCheckoutView = function(permalink) {
      return this._injectTrackingPixel(this.PAGE_TYPE_CHECKOUT, {
        d: permalink
      });
    };

    Tracker.prototype.trackPurchaseView = function(permalink, quantity) {
      return this._injectTrackingPixel(this.PAGE_TYPE_PURCHASE, {
        d: permalink,
        qty: quantity
      });
    };

    Tracker.prototype.trackGiftCardsView = function() {
      return this._injectTrackingPixel(this.PAGE_TYPE_GIFT_CARDS);
    };

    Tracker.prototype.CLICK_TYPE_SHARE = "share";

    Tracker.prototype.EVENT_BUY_BUTTON_CLICK = "buy_button_click";

    Tracker.prototype.trackShareClick = function(permalink, medium, event) {
      return this._injectTrackingPixel(this.CLICK_TYPE_SHARE, {
        d: permalink,
        mdm: medium,
        share_event: event
      });
    };

    Tracker.prototype.trackBuyButtonClick = function(permalink, channel) {
      return this._injectTrackingPixel(this.EVENT_BUY_BUTTON_CLICK, {
        ch: channel != null ? channel : "local",
        d: permalink
      });
    };

    Tracker.prototype.EVENT_AD_IMPRESSION = "ad_impression";

    Tracker.prototype.trackAdImpression = function(id, pos, placement, division_id) {
      var options;
      options = {
        d: division_id,
        id: id,
        pos: pos,
        source: placement
      };
      return this._injectTrackingPixel(this.EVENT_AD_IMPRESSION, options);
    };

    Tracker.experimentInfo = function() {
      return this.prototype.__addExperimentVersionInformation();
    };

    Tracker.prototype._injectTrackingPixel = function(type, options) {
      options = this.__addExperimentVersionInformation(options);
      return Wmw.Analytics.PixelTracker.injectTrackingPixel(type, options);
    };

    Tracker.prototype._trackPageView = function(template, options) {
      return Wmw.Analytics.trackPageView(_.template(template)(options));
    };

    Tracker.prototype._trackClick = function(category, action, label) {
      return Wmw.Analytics.trackClick(category || "", action || "", label || "");
    };

    Tracker.prototype.trackStarRatingClick = function(permalink) {
      return this._injectTrackingPixel("star_rating_bubble", {
        d: permalink
      });
    };

    Tracker.prototype.__addExperimentVersionInformation = function(options) {
      var experimentInfo, key, val, variants, _ref;
      if (options == null) {
        options = {};
      }
      if (typeof App === "undefined" || App === null) {
        return options;
      }
      if (App.ExperimentVersions != null) {
        variants = [];
        _ref = App.ExperimentVersions;
        for (key in _ref) {
          val = _ref[key];
          key = key.toLowerCase();
          val = val === 1 ? "" + key + "_control" : _(val).isNumber() ? "" + key + "_variant" + (val - 1) : "" + key + "_" + (val.toLowerCase());
          variants.push(val);
        }
      }
      experimentInfo = {};
      if (!_(variants).isEmpty()) {
        experimentInfo.v = _(variants).join(",");
      }
      return _.defaults(options, experimentInfo);
    };

    return Tracker;

  })();

}).call(this);
